---
import { Image } from "astro:assets";
import { getCollection } from "astro:content";

type Props = { title: string; lang: string };

const { title, lang } = Astro.props as Props;
const allProjects = await getCollection("projects");
const projects = allProjects.filter((project) => project.slug.startsWith(`${lang}/`));
projects.sort(
  (a, b) => {
    const aHasGithub = !!a.data.github;
    const bHasGithub = !!b.data.github;

    if (aHasGithub && !bHasGithub) return -1;
    if (!aHasGithub && bHasGithub) return 1;

    // Both have github or both don't
    const aCatLen = a.data.categories?.length ?? 0;
    const bCatLen = b.data.categories?.length ?? 0;
    return bCatLen - aCatLen;
  },
);
---

<section class="w-full max-w-6xl mx-auto px-4 py-20 relative">
  <div class="absolute top-0 right-0 w-96 h-96 bg-violet-600/10 rounded-full blur-3xl -z-10 pointer-events-none"></div>
  <h2 class="text-3xl md:text-4xl font-bold text-center mb-12 text-slate-100">{title}</h2>
  <div class="grid grid-cols-1 md:grid-cols-2 gap-8">
    {
      projects.map((project) => (
        <a class="group relative flex flex-col bg-slate-900/50 border border-slate-800 rounded-2xl overflow-hidden hover:border-violet-500/50 hover:shadow-xl hover:shadow-violet-500/10 transition-all duration-300" href={`/projects/${project.slug}/`}>
          <figure class="relative aspect-video overflow-hidden m-0">
            <Image
              transition:name={`image-${project.data.id}`}
              width={410}
              height={360}
              src={project.data.heroImage}
              alt={`${project.data.title}`}
              class="w-full h-full object-cover transition-transform duration-500 group-hover:scale-105"
            />
            <div class="absolute inset-0 bg-gradient-to-t from-slate-950/80 to-transparent opacity-60"></div>
          </figure>
          <div class="p-6 flex flex-col flex-grow">
            <ul
              class="flex flex-wrap gap-2 mb-3 list-none p-0 m-0"
              transition:name={`categories-${project.data.id}`}
            >
              {project.data.categories.map((category: string) => (
                <li class="text-xs font-medium px-2.5 py-0.5 rounded-full bg-violet-500/10 text-violet-300 border border-violet-500/20">
                    {category}
                </li>
              ))}
            </ul>
            <h4
              class="text-xl font-bold text-slate-100 mb-2 group-hover:text-violet-400 transition-colors m-0"
              transition:name={`title-${project.data.id}`}
            >
              {project.data.title}
            </h4>
            <p class="text-slate-200 text-sm line-clamp-3 m-0 leading-relaxed">{project.data.description}</p>
          </div>
        </a>
      ))
    }
  </div>
</section>
